<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EHS Permit-to-Work System</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7f6; margin:0; color:#333; }
header { text-align:center; padding:15px; background:#0d6efd; color:white; font-size:1.5em; }
nav { display:flex; justify-content:center; margin:10px 0; }
nav button { margin:0 5px; padding:10px 15px; border:none; border-radius:5px; background:#e9ecef; cursor:pointer; transition:0.3s;}
nav button.active, nav button:hover { background:#0d6efd; color:#fff;}
.container { max-width: 1200px; margin:auto; padding:10px;}
.card { background:#fff; padding:15px; margin-bottom:15px; border-radius:10px; box-shadow:0 3px 6px rgba(0,0,0,0.1); transition:0.3s; }
.card:hover { box-shadow:0 6px 12px rgba(0,0,0,0.2); }
input, select, textarea, button { padding:6px; margin:4px 0; border-radius:5px; border:1px solid #ccc; width:100%; }
button { cursor:pointer; background:#0d6efd; color:#fff; border:none; transition:0.3s; }
button:hover { background:#0b5ed7; }
label { font-weight:bold; margin-top:5px; display:block; }
.badge { padding:4px 8px; border-radius:5px; color:white; font-size:0.8em; font-weight:bold; }
.badge-Draft { background:#6c757d; }
.badge-Pending { background:#ffc107; color:#212529; }
.badge-Approved { background:#0d6efd; }
.badge-Active { background:#198754; }
.badge-Closed { background:#6c757d; }
.badge-Rejected { background:#dc3545; }
.badge-Suspended { background:#fd7e14; }
.permit-header { display:flex; justify-content: space-between; align-items:center; margin-bottom:10px; }
.permit-title { font-size:1.1em; font-weight:bold; }
.permit-icons i { margin-left:5px; color:#0d6efd; }
</style>
</head>
<body>
<header><i class="fas fa-hard-hat"></i> EHS Permit-to-Work System</header>
<nav>
<button class="active" onclick="showPage('create')">Create Permit</button>
<button onclick="showPage('dashboard')">Dashboard</button>
</nav>

<div class="container">
<!-- Create Permit Page -->
<div id="create" class="page">
<div class="card">
<h2><i class="fas fa-plus-circle"></i> Create New Permit</h2>
<label>Work Location</label><input type="text" id="workLocation" placeholder="Location">
<label>Date & Time</label><input type="datetime-local" id="workDateTime">
<label>Permit Holder Name</label><input type="text" id="permitHolder">
<label>Safety Contact Name</label><input type="text" id="safetyContactName">
<label>Safety Contact Number</label><input type="text" id="safetyContactNumber">
<label>Work Description</label><textarea id="workDescription" rows="4" placeholder="Describe work & hazards"></textarea>
<label>Reviewer Name</label><input type="text" id="reviewerName">
<label>Issuer Name</label><input type="text" id="issuerName">
<label>Holder Acknowledgment</label>
<select id="holderAcknowledgment">
<option value="Pending">Pending</option>
<option value="Accepted">Accepted</option>
<option value="Suspended">Suspended</option>
</select>
<button onclick="addPermit()"><i class="fas fa-save"></i> Save Permit</button>
</div>
</div>

<!-- Dashboard Page -->
<div id="dashboard" class="page" style="display:none;"></div>

</div>

<script>
let permits = JSON.parse(localStorage.getItem('permits')||'[]');

function showPage(page){
document.querySelectorAll('.page').forEach(p=>p.style.display='none');
document.getElementById(page).style.display='block';
document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
event.target.classList.add('active');
if(page==='dashboard') renderDashboard();
}

function savePermits(){localStorage.setItem('permits', JSON.stringify(permits));}

function addPermit(){
const p={id:Date.now(),
location: document.getElementById('workLocation').value,
dateTime: document.getElementById('workDateTime').value,
holder: document.getElementById('permitHolder').value,
safetyName: document.getElementById('safetyContactName').value,
safetyNumber: document.getElementById('safetyContactNumber').value,
description: document.getElementById('workDescription').value,
reviewer: document.getElementById('reviewerName').value,
issuer: document.getElementById('issuerName').value,
acknowledgment: document.getElementById('holderAcknowledgment').value,
status:'Draft'};
permits.push(p); savePermits(); alert('Permit saved!');
document.querySelectorAll('#create input, #create textarea').forEach(i=>i.value='');
document.getElementById('holderAcknowledgment').value='Pending';
showPage('dashboard');
}

function renderDashboard(){
const container=document.getElementById('dashboard'); container.innerHTML='';
permits.forEach(p=>{
const card=document.createElement('div'); card.className='card';
card.innerHTML=`
<div class="permit-header">
<div class="permit-title"><i class="fas fa-map-marker-alt"></i> ${p.location} <span class="badge badge-${p.status}">${p.status}</span></div>
<div class="permit-icons">
<i class="fas fa-user"></i> ${p.holder} 
<i class="fas fa-phone-alt"></i> ${p.safetyNumber} 
</div>
</div>
<p><i class="fas fa-calendar-alt"></i> ${p.dateTime}</p>
<p><i class="fas fa-clipboard-list"></i> ${p.description}</p>
<p><i class="fas fa-user-check"></i> Reviewer: ${p.reviewer} | Issuer: ${p.issuer}</p>
<p><i class="fas fa-handshake"></i> Holder Acknowledgment: ${p.acknowledgment}</p>
<div>
<button onclick="editPermit(${p.id})"><i class="fas fa-edit"></i> Edit</button>
<button onclick="updateAck(${p.id},'Accepted')"><i class="fas fa-check"></i> Accept</button>
<button onclick="updateAck(${p.id},'Suspended')"><i class="fas fa-pause-circle"></i> Suspend</button>
<button onclick="downloadPDF(${p.id})"><i class="fas fa-download"></i> PDF</button>
</div>`;
container.appendChild(card);
});
}

function editPermit(id){
const p=permits.find(x=>x.id===id);
document.getElementById('workLocation').value=p.location;
document.getElementById('workDateTime').value=p.dateTime;
document.getElementById('permitHolder').value=p.holder;
document.getElementById('safetyContactName').value=p.safetyName;
document.getElementById('safetyContactNumber').value=p.safetyNumber;
document.getElementById('workDescription').value=p.description;
document.getElementById('reviewerName').value=p.reviewer;
document.getElementById('issuerName').value=p.issuer;
document.getElementById('holderAcknowledgment').value=p.acknowledgment;
permits=permits.filter(x=>x.id!==id);
showPage('create');
}

function updateAck(id, value){
const p=permits.find(x=>x.id===id); if(p){p.acknowledgment=value; savePermits(); renderDashboard();}
}

function downloadPDF(id){
const { jsPDF } = window.jspdf; const p=permits.find(x=>x.id===id); if(!p) return;
const doc=new jsPDF(); doc.setFontSize(18); doc.text("EHS Permit-to-Work",105,20,null,null,"center");
doc.setFontSize(12);
doc.text(`Work Location: ${p.location}`,20,40);
doc.text(`Date & Time: ${p.dateTime}`,20,50);
doc.text(`Permit Holder: ${p.holder}`,20,60);
doc.text(`Safety Contact: ${p.safetyName} (${p.safetyNumber})`,20,70);
doc.text("Work Description:",20,80);
doc.text(doc.splitTextToSize(p.description,170),20,90);
doc.text(`Reviewer: ${p.reviewer}`,20,120);
doc.text(`Issuer: ${p.issuer}`,20,130);
doc.text(`Holder Acknowledgment: ${p.acknowledgment}`,20,140);
doc.text(`Status: ${p.status}`,20,150);
doc.save(`Permit_${p.holder}_${new Date().toISOString().slice(0,10)}.pdf`);
}

renderDashboard();
</script>
</body>
</html>
