<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EHS Audit Dashboard</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family: Arial, sans-serif; background: #f4f7f6; margin:0; padding:0; }
h1 { text-align:center; color:#2e7d32; font-size:2rem; margin-bottom:20px; }
.container { width:95%; max-width:1200px; margin:auto; padding:10px; box-sizing:border-box; display:flex; flex-direction:column; }
.card { background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1); margin-bottom:20px; }
h2 { color:#2e7d32; font-size:1.5rem; margin-bottom:15px; display:flex; align-items:center; }
h2 i { margin-right:8px; }
form { display:flex; flex-direction:column; }
form label { font-weight:bold; margin-top:10px; display:block; }
input, select, textarea {
  width:100%;
  max-width:100%;
  box-sizing: border-box;
  padding:10px;
  border:1px solid #ccc;
  border-radius:6px;
  font-size:1rem;
}
textarea {
  resize: vertical;
  overflow-wrap: break-word;
  word-wrap: break-word;
  word-break: break-word;
}
form button { margin-top:15px; padding:12px; background:#2e7d32; color:#fff; border:none; border-radius:6px; cursor:pointer; font-size:1rem; }
form button:hover { background:#256628; }
table { width:100%; border-collapse:collapse; margin-top:15px; font-size:0.9rem; text-align:left; }
th, td { border:1px solid #ccc; padding:8px; vertical-align:middle; text-align:left; }
th { background:#2e7d32; color:#fff; }
.risk-high { background:#f8d7da; border:1px solid #f5c6cb; }
.risk-medium { background:#fff3cd; border:1px solid #ffeeba; }
.risk-low { background:#d4edda; border:1px solid #c3e6cb; }
.risk-good { background:#e8f5e9; border:1px solid #2e7d32; }
.export-btn { margin-top:15px; padding:12px 20px; background:#1d6f42; color:#fff; border:none; border-radius:6px; font-size:1rem; cursor:pointer; }
.export-btn i { margin-right:8px; }
.export-btn:hover { background:#145c32; }
.report-box { border:2px solid #2e7d32; padding:15px; background:#f9fff9; border-radius:8px; font-size:1rem; text-align:center;}
label i { margin-right:6px; color:#2e7d32; }

/* Toggle button for mobile */
#toggleFormBtn { display:none; margin-bottom:10px; padding:10px; background:#2e7d32; color:#fff; border:none; border-radius:6px; cursor:pointer; width:100%; font-size:1rem; }
#toggleFormBtn i { margin-right:6px; }

/* Mobile responsive */
@media(max-width:768px){
  table { font-size:0.85rem; display:block; overflow-x:auto; white-space:nowrap; }
  th, td { padding:10px 5px; }
  input, select, textarea, button { font-size:1rem; padding:10px; }
  h1{ font-size:1.6rem; }
  h2{ font-size:1.3rem; }
  .report-box{ font-size:0.95rem; padding:10px; }
}

/* Print styles */
@media print {
  body * { visibility: hidden; }
  #auditTable, #auditReport, #auditTable * { visibility: visible; }
  #auditTable, #auditReport { position: absolute; top: 0; left: 0; width: 100%; }
  #auditTable th, #auditTable td { border:1px solid #000 !important; }
  #printBtn, #exportBtn, #toggleFormBtn, #auditFormCard { display: none !important; }
}
</style>
</head>
<body>
<h1><i class="fas fa-hard-hat"></i> EHS Audit Dashboard</h1>

<div class="container">

<button id="toggleFormBtn"><i class="fas fa-chevron-down"></i> Show/Hide Audit Form</button>

<div class="card" id="auditFormCard">
<h2><i class="fas fa-clipboard-check"></i> Audit Form</h2>
<form id="auditForm">
<label><i class="fas fa-calendar-alt"></i> Audit Date</label><input type="date" id="auditDate" required>
<label><i class="fas fa-user-check"></i> Auditor Name</label><input type="text" id="auditorName" required>
<label><i class="fas fa-map-marker-alt"></i> Location / Site</label><input type="text" id="location" required>
<label><i class="fas fa-eye"></i> Observation</label><textarea id="observation" required></textarea>
<label><i class="fas fa-biohazard"></i> Nature of the Hazard</label><input type="text" id="hazardNature">
<label><i class="fas fa-exclamation-triangle"></i> Category</label>
<select id="category" required>
<option value="High Risk">High Risk</option>
<option value="Medium Risk">Medium Risk</option>
<option value="Low Risk">Low Risk</option>
<option value="Good Practice">Good Practice</option>
</select>
<label><i class="fas fa-clipboard-list"></i> Recommended Action</label><textarea id="recommendedAction"></textarea>
<label><i class="fas fa-tasks"></i> Action Taken</label><textarea id="actionTaken"></textarea>
<label><i class="fas fa-user"></i> Responsible Person</label><input type="text" id="responsiblePerson">
<label><i class="fas fa-calendar-check"></i> Target Date</label><input type="date" id="targetDate">
<label><i class="fas fa-info-circle"></i> Status</label>
<select id="status"><option value="Open">Open</option><option value="Closed">Closed</option></select>
<label><i class="fas fa-camera"></i> Photo</label><input type="file" id="photo" accept="image/*">
<button type="submit"><i class="fas fa-plus-circle"></i> Add Record</button>
</form>
</div>

<div class="card">
<h2><i class="fas fa-table"></i> Audit Records</h2>
<table id="auditTable">
<thead>
<tr>
<th><i class="fas fa-hashtag"></i> S.No</th>
<th><i class="fas fa-calendar-alt"></i> Audit Date</th>
<th><i class="fas fa-user-check"></i> Auditor</th>
<th><i class="fas fa-map-marker-alt"></i> Location</th>
<th><i class="fas fa-eye"></i> Observation</th>
<th><i class="fas fa-biohazard"></i> Nature of Hazard</th>
<th><i class="fas fa-exclamation-triangle"></i> Category</th>
<th><i class="fas fa-clipboard-list"></i> Recommended Action</th>
<th><i class="fas fa-tasks"></i> Action Taken</th>
<th><i class="fas fa-user"></i> Responsible Person</th>
<th><i class="fas fa-calendar-check"></i> Target Date</th>
<th><i class="fas fa-info-circle"></i> Status</th>
<th><i class="fas fa-camera"></i> Photo</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button class="export-btn" id="exportBtn"><i class="fas fa-file-excel"></i> Export to Excel</button>
<button class="export-btn" id="printBtn"><i class="fas fa-print"></i> Print Audit Report</button>
</div>

<div class="card">
<h2><i class="fas fa-file-alt"></i> Audit Report</h2>
<div id="auditReport" class="report-box"><p>No data yet.</p></div>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
let records=[];
function updateReport(){
  if(records.length===0){ document.getElementById("auditReport").innerHTML="<p>No data yet.</p>"; return; }
  let counts={high:0,medium:0,low:0,good:0};
  records.forEach(r=>{
    if(r.category==="High Risk") counts.high++;
    if(r.category==="Medium Risk") counts.medium++;
    if(r.category==="Low Risk") counts.low++;
    if(r.category==="Good Practice") counts.good++;
  });
  document.getElementById("auditReport").innerHTML=`
    <p>🔴 High Risk: ${counts.high}</p>
    <p>🟠 Medium Risk: ${counts.medium}</p>
    <p>🟢 Low Risk: ${counts.low}</p>
    <p>✅ Good Practice: ${counts.good}</p>`;
}

function handleResponsive() {
  if(window.innerWidth <= 768){
    document.getElementById("toggleFormBtn").style.display = "block";
    document.getElementById("auditFormCard").style.display = "none";
  } else {
    document.getElementById("toggleFormBtn").style.display = "none";
    document.getElementById("auditFormCard").style.display = "block";
  }
}
window.addEventListener("resize", handleResponsive);
window.addEventListener("load", handleResponsive);

document.getElementById("toggleFormBtn").addEventListener("click", function(){
  const formCard = document.getElementById("auditFormCard");
  formCard.style.display = (formCard.style.display === "none") ? "block" : "none";
});

document.getElementById("auditForm").addEventListener("submit",function(e){
  e.preventDefault();
  let photoFile=document.getElementById("photo").files[0];
  if(photoFile){
    let reader=new FileReader();
    reader.onload=function(ev){ addRecord(ev.target.result); };
    reader.readAsDataURL(photoFile);
  } else { addRecord(""); }
});

function addRecord(photoData){
  let rec={
    date:document.getElementById("auditDate").value,
    auditor:document.getElementById("auditorName").value,
    location:document.getElementById("location").value,
    observation:document.getElementById("observation").value,
    hazardNature:document.getElementById("hazardNature").value,
    category:document.getElementById("category").value,
    recommendedAction:document.getElementById("recommendedAction").value,
    actionTaken:document.getElementById("actionTaken").value,
    responsiblePerson:document.getElementById("responsiblePerson").value,
    targetDate:document.getElementById("targetDate").value,
    status:document.getElementById("status").value,
    photo:photoData
  };
  records.push(rec); renderTable(); updateReport(); document.getElementById("auditForm").reset();
}

function renderTable(){
  let tbody=document.querySelector("#auditTable tbody"); tbody.innerHTML="";
  records.forEach((r,i)=>{
    let row=document.createElement("tr");
    if(r.category==="High Risk") row.className="risk-high";
    if(r.category==="Medium Risk") row.className="risk-medium";
    if(r.category==="Low Risk") row.className="risk-low";
    if(r.category==="Good Practice") row.className="risk-good";

    let categoryIcon="";
    if(r.category==="High Risk") categoryIcon='<i class="fas fa-exclamation-triangle" style="color:red;"></i>';
    if(r.category==="Medium Risk") categoryIcon='<i class="fas fa-exclamation-triangle" style="color:orange;"></i>';
    if(r.category==="Low Risk") categoryIcon='<i class="fas fa-exclamation-triangle" style="color:green;"></i>';
    if(r.category==="Good Practice") categoryIcon='<i class="fas fa-check-circle" style="color:green;"></i>';

    row.innerHTML=`<td>${i+1}</td><td>${r.date}</td><td>${r.auditor}</td><td>${r.location}</td>
    <td>${r.observation}</td><td>${r.hazardNature}</td><td>${categoryIcon} ${r.category}</td>
    <td>${r.recommendedAction}</td><td>${r.actionTaken}</td><td>${r.responsiblePerson}</td>
    <td>${r.targetDate}</td><td>${r.status}</td>
    <td>${r.photo?'<img src="'+r.photo+'" width="50">':''}</td>`;
    tbody.appendChild(row);
  });
}

// Excel Export
document.getElementById("exportBtn").addEventListener("click", async function () {
  const wb = new ExcelJS.Workbook();
  const ws = wb.addWorksheet("Audit Report");

  ws.mergeCells("A1:M1"); ws.getCell("A1").value = "Project Name: XYZ Project";
  ws.getCell("A1").alignment = { horizontal: "center", vertical: "middle" };
  ws.getCell("A1").font = { bold: true, size: 14 };

  ws.mergeCells("A2:M2"); ws.getCell("A2").value = "Audit No: 001";
  ws.getCell("A2").alignment = { horizontal: "center", vertical: "middle" };
  ws.getCell("A2").font = { bold: true, size: 12 };

  ws.addRow([]);
  const header = ["S.No","Audit Date","Auditor","Location","Observation","Nature of Hazard","Category","Recommended Action","Action Taken","Responsible Person","Target Date","Status","Photo"];
  const headerRow = ws.addRow(header);
  headerRow.eachCell((cell) => {
    cell.font = { bold: true, color: { argb: "FFFFFFFF" } };
    cell.fill = { type: "pattern", pattern: "solid", fgColor: { argb: "FF2E7D32" } };
    cell.alignment = { horizontal: "left", vertical: "middle", wrapText: true };
    cell.border = { top:{style:"thin"}, left:{style:"thin"}, bottom:{style:"thin"}, right:{style:"thin"} };
  });

  ws.columns = [
    { width: 6 }, { width: 12 }, { width: 15 }, { width: 15 }, { width: 25 },
    { width: 20 }, { width: 15 }, { width: 25 }, { width: 25 }, { width: 15 },
    { width: 12 }, { width: 10 }, { width: 15 }
  ];

  for (let i = 0; i < records.length; i++) {
    let r = records[i];
    let categorySymbol = "", fillColor = "";
    if (r.category === "High Risk") { categorySymbol = "❗"; fillColor = "FFCDD2"; }
    if (r.category === "Medium Risk") { categorySymbol = "⚠️"; fillColor = "FFF9C4"; }
    if (r.category === "Low Risk") { categorySymbol = "⚠️"; fillColor = "C8E6C9"; }
    if (r.category === "Good Practice") { categorySymbol = "✔️"; fillColor = "E8F5E9"; }

    const row = ws.addRow([i+1,r.date,r.auditor,r.location,r.observation,r.hazardNature,
      `${categorySymbol} ${r.category}`,r.recommendedAction,r.actionTaken,r.responsiblePerson,
      r.targetDate,r.status,""
    ]);
    row.height = 50;
    row.eachCell((cell) => {
      cell.fill = { type: 'pattern', pattern: 'solid', fgColor: { argb: fillColor } };
      cell.alignment = { horizontal: "left", vertical: "middle", wrapText: true };
      cell.border = { top:{style:"thin"}, left:{style:"thin"}, bottom:{style:"thin"}, right:{style:"thin"} };
    });

    if(r.photo){ const imageId = wb.addImage({ base64:r.photo, extension:'png' }); 
      ws.addImage(imageId,{tl:{col:12,row:row.number-1},ext:{width:50,height:50}}); }
  }

  ws.addRow([]);
  const summaryTitle = ws.addRow(["Audit Report Summary"]);
  summaryTitle.eachCell(c => { c.alignment = { horizontal: "center" }; c.font = { bold: true }; });
  ws.addRow(["High Risk", records.filter(r=>r.category==="High Risk").length]);
  ws.addRow(["Medium Risk", records.filter(r=>r.category==="Medium Risk").length]);
  ws.addRow(["Low Risk", records.filter(r=>r.category==="Low Risk").length]);
  ws.addRow(["Good Practice", records.filter(r=>r.category==="Good Practice").length]);

  wb.xlsx.writeBuffer().then(function (data) {
    const blob = new Blob([data], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
    saveAs(blob, "Audit_Report.xlsx");
  });
});

// Print button
document.getElementById("printBtn").addEventListener("click", function() {
  window.print();
});
</script>
</body>
</html>
