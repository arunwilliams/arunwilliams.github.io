<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>HSE Audit Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h2 {
      color: #2e7d32;
      font-size: 1.5rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
      color: #2e7d32;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .btn {
      background: #2e7d32;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: 0.3s;
    }
    .btn:hover {
      background: #256528;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }
    th {
      background: #2e7d32;
      color: white;
    }
    .high-risk { background: #f8d7da; border: 1px solid #f5c6cb; }
    .medium-risk { background: #fff3cd; border: 1px solid #ffeeba; }
    .low-risk { background: #d4edda; border: 1px solid #c3e6cb; }
    .good-practice { background: #e8f5e9; border: 1px solid #2e7d32; }
    .photo-preview {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Audit Form -->
    <div class="card">
      <h2><i class="fas fa-hard-hat"></i> Audit Form</h2>
      <div class="form-group">
        <label><i class="fas fa-calendar-alt"></i> Audit Date</label>
        <input type="date" id="auditDate">
      </div>
      <div class="form-group">
        <label><i class="fas fa-user"></i> Auditor Name</label>
        <input type="text" id="auditorName">
      </div>
      <div class="form-group">
        <label><i class="fas fa-map-marker-alt"></i> Location / Site</label>
        <input type="text" id="location">
      </div>
      <div class="form-group">
        <label><i class="fas fa-exclamation-triangle"></i> Observation</label>
        <textarea id="observation"></textarea>
      </div>
      <div class="form-group">
        <label><i class="fas fa-fire"></i> Nature of Hazard</label>
        <input type="text" id="hazardNature">
      </div>
      <div class="form-group">
        <label><i class="fas fa-flag"></i> Category</label>
        <select id="category">
          <option>High Risk</option>
          <option>Medium Risk</option>
          <option>Low Risk</option>
          <option>Good Practice</option>
        </select>
      </div>
      <div class="form-group">
        <label><i class="fas fa-tasks"></i> Recommended Action</label>
        <textarea id="recommendedAction"></textarea>
      </div>
      <div class="form-group">
        <label><i class="fas fa-check-circle"></i> Action Taken</label>
        <textarea id="actionTaken"></textarea>
      </div>
      <div class="form-group">
        <label><i class="fas fa-user-check"></i> Responsible Person</label>
        <input type="text" id="responsiblePerson">
      </div>
      <div class="form-group">
        <label><i class="fas fa-calendar-check"></i> Target Date</label>
        <input type="date" id="targetDate">
      </div>
      <div class="form-group">
        <label><i class="fas fa-tasks"></i> Status</label>
        <select id="status">
          <option>Open</option>
          <option>Closed</option>
        </select>
      </div>
      <div class="form-group">
        <label><i class="fas fa-camera"></i> Upload Photo</label>
        <input type="file" id="photo" accept="image/*">
      </div>
      <button class="btn" onclick="addRecord()"><i class="fas fa-plus-circle"></i> Add Record</button>
    </div>

    <!-- Records Table -->
    <div class="card">
      <h2><i class="fas fa-table"></i> Audit Records</h2>
      <table id="recordsTable">
        <thead>
          <tr>
            <th>S.No</th>
            <th>Audit Date</th>
            <th>Auditor Name</th>
            <th>Location</th>
            <th>Observation</th>
            <th>Nature of Hazard</th>
            <th>Category</th>
            <th>Recommended Action</th>
            <th>Action Taken</th>
            <th>Responsible Person</th>
            <th>Target Date</th>
            <th>Status</th>
            <th>Photo</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <br>
      <button class="btn" onclick="exportExcel()"><i class="fas fa-file-excel"></i> Export to Excel</button>
    </div>
  </div>

<script>
  let recordCount = 0;
  let records = [];

  function addRecord() {
    const auditDate = document.getElementById("auditDate").value;
    const auditorName = document.getElementById("auditorName").value;
    const location = document.getElementById("location").value;
    const observation = document.getElementById("observation").value;
    const hazardNature = document.getElementById("hazardNature").value;
    const category = document.getElementById("category").value;
    const recommendedAction = document.getElementById("recommendedAction").value;
    const actionTaken = document.getElementById("actionTaken").value;
    const responsiblePerson = document.getElementById("responsiblePerson").value;
    const targetDate = document.getElementById("targetDate").value;
    const status = document.getElementById("status").value;
    const photoFile = document.getElementById("photo").files[0];

    let photoURL = "";
    if (photoFile) {
      const reader = new FileReader();
      reader.onload = function(e) {
        photoURL = e.target.result;
        saveRecord(photoURL);
      };
      reader.readAsDataURL(photoFile);
    } else {
      saveRecord(photoURL);
    }

    function saveRecord(photo) {
      recordCount++;
      const newRow = document.createElement("tr");

      let riskClass = "";
      if (category === "High Risk") riskClass = "high-risk";
      else if (category === "Medium Risk") riskClass = "medium-risk";
      else if (category === "Low Risk") riskClass = "low-risk";
      else if (category === "Good Practice") riskClass = "good-practice";

      newRow.className = riskClass;
      newRow.innerHTML = `
        <td>${recordCount}</td>
        <td>${auditDate}</td>
        <td>${auditorName}</td>
        <td>${location}</td>
        <td>${observation}</td>
        <td>${hazardNature}</td>
        <td>${category}</td>
        <td>${recommendedAction}</td>
        <td>${actionTaken}</td>
        <td>${responsiblePerson}</td>
        <td>${targetDate}</td>
        <td>${status}</td>
        <td>${photo ? `<img src="${photo}" class="photo-preview">` : ''}</td>
      `;
      document.querySelector("#recordsTable tbody").appendChild(newRow);

      records.push({auditDate, auditorName, location, observation, hazardNature, category, recommendedAction, actionTaken, responsiblePerson, targetDate, status, photo});
    }
  }

  function exportExcel() {
    const ws_data = [
      ["Project Name: ___________________", "Audit No: _____________"],
      [],
      ["S.No","Audit Date","Auditor Name","Location","Observation","Nature of Hazard","Category","Recommended Action","Action Taken","Responsible Person","Target Date","Status","Photo"]
    ];

    records.forEach((rec, i) => {
      ws_data.push([
        i+1, rec.auditDate, rec.auditorName, rec.location, rec.observation,
        rec.hazardNature, rec.category, rec.recommendedAction, rec.actionTaken,
        rec.responsiblePerson, rec.targetDate, rec.status, rec.photo ? "Attached" : ""
      ]);
    });

    const ws = XLSX.utils.aoa_to_sheet(ws_data);

    // Risk-based coloring
    records.forEach((rec, i) => {
      const rowIndex = i + 4; // offset
      let fillColor = "";
      if (rec.category === "High Risk") fillColor = "FFCDD2";
      else if (rec.category === "Medium Risk") fillColor = "FFF9C4";
      else if (rec.category === "Low Risk") fillColor = "C8E6C9";
      else if (rec.category === "Good Practice") fillColor = "E8F5E9";

      for (let col = 0; col < 13; col++) {
        const cellAddress = XLSX.utils.encode_cell({c: col, r: rowIndex-1});
        if (!ws[cellAddress]) continue;
        ws[cellAddress].s = {
          fill: { fgColor: { rgb: fillColor } },
          alignment: { horizontal: "center", vertical: "center" }
        };
      }
    });

    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Audit Data");
    XLSX.writeFile(wb, "Audit_Data.xlsx");
  }
</script>
</body>
</html>
