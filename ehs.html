<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EHS Audit Data Collection</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    h1 {
      color: #2e7d32;
      text-align: center;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      max-width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }

    .card h2 {
      margin-bottom: 15px;
      color: #2e7d32;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    form input, form select, form textarea {
      width: 100%;
      padding: 8px;
      margin: 6px 0 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      background: #2e7d32;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    button:hover {
      background: #256528;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    table th, table td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    table th {
      background: #2e7d32;
      color: white;
    }

    /* Risk Level Colors */
    .high-risk {
      background: #f8d7da !important;
      border: 1px solid #f5c6cb !important;
    }
    .medium-risk {
      background: #fff3cd !important;
      border: 1px solid #ffeeba !important;
    }
    .low-risk {
      background: #d4edda !important;
      border: 1px solid #c3e6cb !important;
    }
    .good-practice {
      background: #e8f5e9 !important;
      border: 1px solid #2e7d32 !important;
    }
  </style>
</head>
<body>

  <h1><i class="fas fa-hard-hat"></i> EHS Audit Data Collection</h1>

  <!-- Audit Form -->
  <div class="card">
    <h2><i class="fas fa-hard-hat"></i> Audit Form</h2>
    <form id="auditForm">
      <label>Audit Date</label>
      <input type="date" id="auditDate" required>
      
      <label>Auditor Name</label>
      <input type="text" id="auditorName" required>
      
      <label>Location / Site</label>
      <input type="text" id="location" required>
      
      <label>Observation</label>
      <textarea id="observation" required></textarea>
      
      <label>Nature of the Hazard</label>
      <input type="text" id="hazard" required>
      
      <label>Category</label>
      <select id="category" required>
        <option value="">--Select--</option>
        <option>High Risk</option>
        <option>Medium Risk</option>
        <option>Low Risk</option>
        <option>Good Practice</option>
      </select>
      
      <label>Action Taken</label>
      <textarea id="actionTaken"></textarea>
      
      <label>Responsible Person</label>
      <input type="text" id="responsiblePerson">
      
      <label>Target Date</label>
      <input type="date" id="targetDate">
      
      <label>Status</label>
      <select id="status">
        <option>Open</option>
        <option>Closed</option>
      </select>

      <button type="submit"><i class="fas fa-plus-circle"></i> Add Record</button>
    </form>
  </div>

  <!-- Records -->
  <div class="card">
    <h2><i class="fas fa-table"></i> Audit Records</h2>
    <button onclick="exportToExcel()"><i class="fas fa-file-excel"></i> Export to Excel</button>
    <table id="recordsTable">
      <thead>
        <tr>
          <th>Audit Date</th>
          <th>Auditor Name</th>
          <th>Location / Site</th>
          <th>Observation</th>
          <th>Nature of Hazard</th>
          <th>Category</th>
          <th>Action Taken</th>
          <th>Responsible Person</th>
          <th>Target Date</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const form = document.getElementById("auditForm");
const tableBody = document.querySelector("#recordsTable tbody");
let records = [];

form.addEventListener("submit", function(e) {
  e.preventDefault();

  const record = {
    auditDate: document.getElementById("auditDate").value,
    auditorName: document.getElementById("auditorName").value,
    location: document.getElementById("location").value,
    observation: document.getElementById("observation").value,
    hazard: document.getElementById("hazard").value,
    category: document.getElementById("category").value,
    actionTaken: document.getElementById("actionTaken").value,
    responsiblePerson: document.getElementById("responsiblePerson").value,
    targetDate: document.getElementById("targetDate").value,
    status: document.getElementById("status").value
  };

  records.push(record);
  addRow(record);
  form.reset();
});

function addRow(record) {
  const row = document.createElement("tr");

  row.innerHTML = `
    <td>${record.auditDate}</td>
    <td>${record.auditorName}</td>
    <td>${record.location}</td>
    <td>${record.observation}</td>
    <td>${record.hazard}</td>
    <td>${record.category}</td>
    <td>${record.actionTaken}</td>
    <td>${record.responsiblePerson}</td>
    <td>${record.targetDate}</td>
    <td>${record.status}</td>
  `;

  // Apply risk class
  if (record.category === "High Risk") row.classList.add("high-risk");
  if (record.category === "Medium Risk") row.classList.add("medium-risk");
  if (record.category === "Low Risk") row.classList.add("low-risk");
  if (record.category === "Good Practice") row.classList.add("good-practice");

  tableBody.appendChild(row);
}

function exportToExcel() {
  // Clone table
  const table = document.getElementById("recordsTable").cloneNode(true);

  // Add project title rows
  const header = table.createTHead();
  const row1 = header.insertRow(0);
  const cell1 = row1.insertCell(0);
  cell1.colSpan = 10;
  cell1.innerHTML = "<b>Project Name: __________________ | Audit No: _____________</b>";
  cell1.style.textAlign = "center";

  const wb = XLSX.utils.table_to_book(table, {sheet:"Audit Records"});
  XLSX.writeFile(wb, "Audit_Records.xlsx");
}
</script>
</body>
</html>
